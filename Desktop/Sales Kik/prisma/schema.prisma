// Core SalesKik Schema for Supabase - Working Models Only
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core Company Model
model Company {
  id                  String   @id @default(uuid())
  name                String
  email               String
  phone               String?
  address             Json?
  logoUrl             String?  @map("logo_url")
  subscriptionStatus  String   @default("TRIAL") @map("subscription_status")
  trialEndsAt         DateTime? @map("trial_ends_at")
  created_at          DateTime @default(now()) @map("created_at")
  updated_at          DateTime @updatedAt @map("updated_at")
  
  // Working Relations
  users       User[]
  customers   Customer[]
  quotes      Quote[]
  orders      Order[]
  invoices    Invoice[]
  locations   Location[]
  suppliers   Supplier[]
  products    Product[]
  userGroups  UserGroup[]
  categories  Category[]
  quote_templates QuoteTemplate[]
  
  // New Onboarding Relations
  settings            CompanySetting[]
  modules             CompanyModule[]
  onboarding_progress OnboardingProgress?
  notifications       Notification[]
  
  @@map("companies")
}

// User Management
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String
  firstName    String?  @map("first_name")
  lastName     String?  @map("last_name")
  passwordHash String   @map("password_hash")
  role         String   @default("USER")
  company_id   String   @map("company_id")
  company      Company  @relation(fields: [company_id], references: [id])
  isActive     Boolean  @default(true) @map("is_active")
  lastLogin    DateTime? @map("last_login")
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @updatedAt @map("updated_at")
  
  // Relations
  authSessions AuthSession[]
  groupMemberships UserGroupMembership[]
  notifications Notification[]
  
  @@map("users")
}

// Product Catalog - Core Product Information
model Product {
  id                    String               @id @default(uuid())
  code                  String               @unique
  name                  String
  description           String?
  category_id           String?              @map("category_id")
  category              Category?            @relation(fields: [category_id], references: [id])
  main_category_id      String?              @map("main_category_id")
  sub_category_id       String?              @map("sub_category_id") 
  sub_sub_category_id   String?              @map("sub_sub_category_id")
  sub_sub_sub_category_id String?            @map("sub_sub_sub_category_id")
  supplier_id           String?              @map("supplier_id")
  supplier              Supplier?            @relation(fields: [supplier_id], references: [id])
  weight                Float?
  dimensions            Json?                // Store length, width, height as JSON
  company_id            String               @map("company_id")
  company               Company              @relation(fields: [company_id], references: [id])
  is_active             Boolean              @default(true) @map("is_active")
  created_at            DateTime             @default(now()) @map("created_at")
  updated_at            DateTime             @updatedAt @map("updated_at")
  
  // Relations
  pricing       ProductPricing[]
  inventory     ProductInventory[]
  supplier_products SupplierProduct[]
  quote_line_items QuoteLineItem[]
  
  @@map("products")
}

// Product Pricing - Separate Table for Multiple Price Tiers
model ProductPricing {
  id         String  @id @default(uuid())
  product_id String  @map("product_id")
  product    Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  // Pricing Tiers
  cost_price Float   @default(0) @map("cost_price")
  tier_1     Float   @default(0) @map("tier_1")
  tier_2     Float   @default(0) @map("tier_2") 
  tier_3     Float   @default(0) @map("tier_3")
  retail     Float   @default(0)
  
  // Customer-specific pricing
  customer_id String? @map("customer_id")
  customer    Customer? @relation(fields: [customer_id], references: [id])
  
  // Pricing metadata
  effective_date DateTime @default(now()) @map("effective_date")
  expires_date   DateTime? @map("expires_date")
  created_at     DateTime @default(now()) @map("created_at")
  updated_at     DateTime @updatedAt @map("updated_at")
  
  @@unique([product_id, customer_id]) // One pricing record per product per customer
  @@map("product_pricing")
}

// Product Inventory - Separate Table for Stock Management
model ProductInventory {
  id              String  @id @default(uuid())
  product_id      String  @map("product_id")
  product         Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
  location_id     String  @map("location_id")
  location        Location @relation(fields: [location_id], references: [id])
  
  // Stock levels
  current_stock   Int     @default(0) @map("current_stock")
  reserved_stock  Int     @default(0) @map("reserved_stock")
  available_stock Int     @default(0) @map("available_stock")
  reorder_point   Int     @default(10) @map("reorder_point")
  max_stock       Int     @default(100) @map("max_stock")
  
  // Stock metadata
  last_counted    DateTime? @map("last_counted")
  last_movement   DateTime? @map("last_movement")
  created_at      DateTime @default(now()) @map("created_at")
  updated_at      DateTime @updatedAt @map("updated_at")
  
  @@unique([product_id, location_id]) // One inventory record per product per location
  @@map("product_inventory")
}

// Customer Management
model Customer {
  id               String   @id @default(uuid())
  
  // Customer Details
  name             String   // Customer Name *
  accounting_id    String?  @map("accounting_id") // Accounting ID
  sales_rep_id     String?  @map("sales_rep_id")  // Sales Representative ID
  sales_rep_name   String?  @map("sales_rep_name") // Sales Rep Name
  abn_number       String?  @map("abn_number")     // ABN Number
  phone            String?  // Phone Number
  email            String?  // Email
  
  // Primary Contact
  primary_contact_first_name String? @map("primary_contact_first_name")
  primary_contact_last_name  String? @map("primary_contact_last_name") // Last Name *
  primary_contact_email      String? @map("primary_contact_email")     // Email
  primary_contact_landline   String? @map("primary_contact_landline")  // Landline
  primary_contact_fax        String? @map("primary_contact_fax")       // Fax  
  primary_contact_mobile     String? @map("primary_contact_mobile")    // Mobile
  
  // Location Details
  location_type    String?  @default("Main") @map("location_type") // Main, Branch, etc.
  
  // Address Types (separate fields for clarity)
  mailing_address  Json?    @map("mailing_address")  // Mailing address
  billing_address  Json?    @map("billing_address")  // Billing address  
  delivery_address Json?    @map("delivery_address") // Delivery address
  
  // Legacy address field (for backward compatibility)
  address          Json?    // Location details as JSON
  
  // Account Details
  invoice_type     String?  @default("Account") @map("invoice_type") // Account, Cash, etc.
  accounting_terms String?  @map("accounting_terms") // Accounting Terms
  payment_terms    String?  @map("payment_terms")    // Payment Terms
  payment_due_days Int?     @default(30) @map("payment_due_days") // Due X days after invoice
  credit_limit     Float?   @map("credit_limit")     // Credit Limit
  available_limit  Float?   @map("available_limit")  // Available Limit
  
  // Status and Notes
  status           String   @default("active") @map("status") // Status (active, inactive, prospect)
  notes            String?  // Notes
  
  company_id       String   @map("company_id")
  company          Company  @relation(fields: [company_id], references: [id])
  created_at       DateTime @default(now()) @map("created_at")
  updated_at       DateTime @updatedAt @map("updated_at")
  
  // Relationships
  quotes           Quote[]
  orders           Order[]
  invoices         Invoice[]
  pricing          ProductPricing[]
  additional_contacts CustomerContact[]
  price_lists      CustomerPriceList[]
  
  @@map("customers")
}

// Additional Customer Contacts
model CustomerContact {
  id           String   @id @default(uuid())
  customer_id  String   @map("customer_id")
  customer     Customer @relation(fields: [customer_id], references: [id])
  
  first_name   String   @map("first_name") // First Name *
  last_name    String   @map("last_name")  // Last Name *  
  email        String?  // Email
  landline     String?  // Landline
  fax          String?  // Fax
  mobile       String?  // Mobile
  
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @updatedAt @map("updated_at")
  
  @@map("customer_contacts")
}

// Customer Price Lists (T1, T2, T3, T4+ with Category Integration)
model CustomerPriceList {
  id          String   @id @default(uuid())
  customer_id String   @map("customer_id")
  customer    Customer @relation(fields: [customer_id], references: [id])
  
  // Category Integration for Price Lists
  category_id String?  @map("category_id") // Link to categories
  category    Category? @relation(fields: [category_id], references: [id])
  
  tier_name   String   @map("tier_name") // T1, T2, T3, T4, etc.
  discount    Float?   // Discount percentage
  markup      Float?   // Markup percentage
  is_active   Boolean  @default(true) @map("is_active")
  
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  @@unique([customer_id, category_id, tier_name]) // Unique per customer+category+tier
  @@map("customer_price_lists")
}

// Quote System
model Quote {
  id           String   @id @default(uuid())
  quote_number String   @map("quote_number")
  customer_id  String   @map("customer_id")
  customer     Customer @relation(fields: [customer_id], references: [id])
  company_id   String   @map("company_id")
  company      Company  @relation(fields: [company_id], references: [id])
  template_id  String?  @map("template_id")
  template     QuoteTemplate? @relation(fields: [template_id], references: [id])
  
  // Quote Details
  reference_number     String? @map("reference_number")
  job_name            String? @map("job_name") 
  job_description     String? @map("job_description")
  special_instructions String? @map("special_instructions")
  delivery_address    String? @map("delivery_address")
  billing_address     String? @map("billing_address")
  
  // Financial
  subtotal       Float @default(0)
  tax_amount     Float @default(0) @map("tax_amount")
  discount_amount Float @default(0) @map("discount_amount")
  total_amount   Float @default(0) @map("total_amount")
  payment_terms  Int?  @map("payment_terms")
  
  // Status & Dates  
  status         String   @default("DRAFT")
  quote_date     DateTime @default(now()) @map("quote_date")
  valid_until    DateTime? @map("valid_until")
  sent_at        DateTime? @map("sent_at")
  viewed_at      DateTime? @map("viewed_at") 
  accepted_at    DateTime? @map("accepted_at")
  
  // Metadata
  created_by String  @map("created_by")
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")
  notes      String?
  
  // Relations
  line_items QuoteLineItem[]
  documents  QuoteDocument[]
  orders     Order[]
  
  @@map("quotes")
}

// Quote Line Items
model QuoteLineItem {
  id          String @id @default(uuid())
  quote_id    String @map("quote_id")
  quote       Quote  @relation(fields: [quote_id], references: [id], onDelete: Cascade)
  product_id  String @map("product_id")
  product     Product @relation(fields: [product_id], references: [id])
  
  // Job Organization
  job_section_name String? @map("job_section_name")
  sort_order      Int     @default(0) @map("sort_order")
  
  // Product Details (snapshot at time of quote)
  product_name    String @map("product_name")
  product_code    String @map("product_code") 
  description     String?
  category_path   String? @map("category_path")
  
  // Pricing
  quantity        Float  @default(1)
  unit_price      Float  @map("unit_price")
  total_price     Float  @map("total_price")
  customer_tier   String? @map("customer_tier")
  
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")
  
  @@map("quote_line_items")
}

// Quote Templates for Customization
model QuoteTemplate {
  id         String @id @default(uuid())
  company_id String @map("company_id")
  company    Company @relation(fields: [company_id], references: [id])
  
  name       String
  is_default Boolean @default(false) @map("is_default")
  
  // Company Branding
  company_logo_url String? @map("company_logo_url")
  company_name     String? @map("company_name")
  company_address  String? @map("company_address")
  company_phone    String? @map("company_phone")
  company_email    String? @map("company_email")
  company_website  String? @map("company_website")
  
  // Template Layout (JSON fields for flexibility)
  header_template  Json? @map("header_template")
  footer_template  Json? @map("footer_template")
  color_scheme     Json? @map("color_scheme")
  font_settings    Json? @map("font_settings")
  layout_settings  Json? @map("layout_settings")
  
  // Content Templates  
  terms_and_conditions String? @map("terms_and_conditions")
  payment_terms_text   String? @map("payment_terms_text")
  thank_you_message    String? @map("thank_you_message")
  validity_message     String? @map("validity_message")
  
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")
  
  // Relations
  quotes Quote[]
  
  @@map("quote_templates")
}

// Quote Documents (PDFs and attachments)
model QuoteDocument {
  id            String @id @default(uuid())
  quote_id      String @map("quote_id")
  quote         Quote  @relation(fields: [quote_id], references: [id], onDelete: Cascade)
  
  file_name     String @map("file_name")
  file_path     String @map("file_path")
  file_url      String? @map("file_url")
  document_type String @map("document_type") // 'quote_pdf', 'terms_pdf', 'attachment'
  file_size     Int?   @map("file_size")
  mime_type     String? @map("mime_type")
  
  generated_at  DateTime @default(now()) @map("generated_at")
  created_at    DateTime @default(now()) @map("created_at")
  
  @@map("quote_documents")
}

// Order System
model Order {
  id           String   @id @default(uuid())
  order_number String   @map("order_number")
  customer_id  String   @map("customer_id")
  customer     Customer @relation(fields: [customer_id], references: [id])
  company_id   String   @map("company_id")
  company      Company  @relation(fields: [company_id], references: [id])
  quote_id     String?  @map("quote_id")
  quote        Quote?   @relation(fields: [quote_id], references: [id])
  status       String   @default("PENDING")
  total        Float    @default(0)
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @updatedAt @map("updated_at")
  
  invoices     Invoice[]
  
  @@map("orders")
}

// Invoice System
model Invoice {
  id            String   @id @default(uuid())
  invoice_number String @map("invoice_number")
  customerId    String
  customer      Customer @relation(fields: [customerId], references: [id])
  companyId     String
  company       Company  @relation(fields: [companyId], references: [id])
  orderId       String?
  order         Order?   @relation(fields: [orderId], references: [id])
  status        String   @default("DRAFT")
  total         Float    @default(0)
  due_date      DateTime? @map("due_date")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("invoices")
}

// Location Management
model Location {
  id          String   @id @default(uuid())
  name        String
  address     Json?
  company_id  String   @map("company_id")
  company     Company  @relation(fields: [company_id], references: [id])
  is_active   Boolean  @default(true) @map("is_active")
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  inventory   ProductInventory[]
  
  @@map("locations")
}

// Enhanced Supplier Management
model Supplier {
  id               String   @id @default(uuid())
  
  // Basic Supplier Information
  name             String   // Supplier Name *
  mobile           String?  // Mobile
  email            String?  // Email  
  accounting_id    String?  @map("accounting_id") // Accounting ID
  
  // Primary Contact Information
  primary_contact_first_name String? @map("primary_contact_first_name") // First Name *
  primary_contact_last_name  String? @map("primary_contact_last_name")  // Last Name *
  primary_contact_position   String? @map("primary_contact_position")   // Position
  primary_contact_email      String? @map("primary_contact_email")      // Email
  primary_contact_landline   String? @map("primary_contact_landline")   // Landline
  primary_contact_fax        String? @map("primary_contact_fax")        // Fax
  primary_contact_mobile     String? @map("primary_contact_mobile")     // Mobile
  
  // Address Information (JSON fields for structured address data)
  mailing_address  Json?    @map("mailing_address")  // Mailing address with all fields
  billing_address  Json?    @map("billing_address")  // Billing address
  delivery_address Json?    @map("delivery_address") // Delivery address
  
  // Legacy address field (for backward compatibility)
  address          Json?    // Location details as JSON
  
  // Category Integration
  primary_category_id String? @map("primary_category_id")
  primary_category    Category? @relation(fields: [primary_category_id], references: [id])
  
  // System Information
  company_id       String   @map("company_id")
  company          Company  @relation(fields: [company_id], references: [id])
  is_active        Boolean  @default(true) @map("is_active")
  created_at       DateTime @default(now()) @map("created_at")
  updated_at       DateTime @updatedAt @map("updated_at")
  
  // Relations
  products              Product[]
  additional_contacts   SupplierContact[]
  supplier_products     SupplierProduct[]
  addresses            SupplierAddress[]
  
  @@map("suppliers")
}

// Additional Supplier Contacts
model SupplierContact {
  id           String   @id @default(uuid())
  supplier_id  String   @map("supplier_id")
  supplier     Supplier @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  
  first_name   String   @map("first_name") // First Name *
  last_name    String   @map("last_name")  // Last Name *  
  position     String?  // Position
  email        String?  // Email
  landline     String?  // Landline
  fax          String?  // Fax
  mobile       String?  // Mobile
  
  created_at   DateTime @default(now()) @map("created_at")
  updated_at   DateTime @updatedAt @map("updated_at")
  
  @@map("supplier_contacts")
}

// Supplier Addresses with detailed structure
model SupplierAddress {
  id            String   @id @default(uuid())
  supplier_id   String   @map("supplier_id")
  supplier      Supplier @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  
  // Address Type and Usage
  address_type  String   @map("address_type") // "Mailing", "Billing", "Delivery"
  usage_type    String   @map("usage_type")   // How this address is used
  
  // Address Details
  unit_number   String?  @map("unit_number")   // Unit Number
  street_number String?  @map("street_number") // Street Number  
  street_name   String?  @map("street_name")   // Street Name
  city          String?  // City
  state         String?  // State
  postcode      String?  // Postcode
  country       String?  @default("Australia") // Country
  
  is_primary    Boolean  @default(false) @map("is_primary")
  created_at    DateTime @default(now()) @map("created_at")
  updated_at    DateTime @updatedAt @map("updated_at")
  
  @@map("supplier_addresses")
}

// Supplier Product Junction - Track which products each supplier provides
model SupplierProduct {
  id                String   @id @default(uuid())
  supplier_id       String   @map("supplier_id")
  supplier          Supplier @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  product_id        String   @map("product_id")
  product           Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)
  
  // Supplier-specific product details
  supplier_product_code String? @map("supplier_product_code") // Supplier's code for this product
  cost_price           Float?   @map("cost_price")            // Cost from this supplier
  lead_time_days       Int?     @default(7) @map("lead_time_days") // Delivery time
  minimum_order_qty    Int?     @default(1) @map("minimum_order_qty") // Min order quantity
  is_preferred         Boolean  @default(false) @map("is_preferred") // Preferred supplier for this product
  is_active            Boolean  @default(true) @map("is_active")
  
  created_at          DateTime @default(now()) @map("created_at")
  updated_at          DateTime @updatedAt @map("updated_at")
  
  @@unique([supplier_id, product_id]) // One record per supplier-product combination
  @@map("supplier_products")
}

// Authentication Session Management
model AuthSession {
  id           String    @id @default(uuid())
  userId       String    @map("user_id")
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  token        String    @unique
  refreshToken String    @unique @map("refresh_token")
  expiresAt    DateTime  @map("expires_at")
  deviceInfo   Json?     @map("device_info")
  ipAddress    String?   @map("ip_address")
  lastActivity DateTime? @map("last_activity")
  created_at   DateTime  @default(now()) @map("created_at")
  updated_at   DateTime  @updatedAt @map("updated_at")
  
  @@map("auth_sessions")
}

// User Group Management
model UserGroup {
  id          String   @id @default(uuid())
  companyId   String   @map("company_id")
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  name        String
  description String?
  permissions Json     @default("{}")
  isActive    Boolean  @default(true) @map("is_active")
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  // Relations
  memberships UserGroupMembership[]
  
  @@unique([companyId, name])
  @@map("user_groups")
}

model UserGroupMembership {
  id       String    @id @default(uuid())
  userId   String    @map("user_id")
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  groupId  String    @map("group_id")
  group    UserGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  joinedAt DateTime  @default(now()) @map("joined_at")
  
  @@unique([userId, groupId])
  @@map("user_group_memberships")
}

// Clean Category Structure - 5 Levels: Color, Main, Sub, Sub Sub, Sub Sub Sub
model Category {
  id          String   @id @default(uuid())
  name        String
  description String?
  color       String   @default("#3B82F6")
  sort_order  Int      @default(0) @map("sort_order")
  is_active   Boolean  @default(true) @map("is_active")
  company_id  String   @map("company_id")
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  // Relations
  main_categories     MainCategory[]
  products            Product[]
  customer_pricelists CustomerPriceList[]
  subcategories       Subcategory[] @relation("CategorySubcategories")
  suppliers           Supplier[]
  
  @@map("categories")
}

// Level 1: Main Categories
model MainCategory {
  id          String   @id @default(uuid())
  name        String
  description String?
  sort_order  Int      @default(0) @map("sort_order")
  is_active   Boolean  @default(true) @map("is_active")
  category_id String   @map("category_id")
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  // Relations
  sub_categories SubCategory[]
  
  @@map("main_categories")
}

// Level 2: Sub Categories
model SubCategory {
  id               String       @id @default(uuid())
  name             String
  description      String?
  sort_order       Int          @default(0) @map("sort_order")
  is_active        Boolean      @default(true) @map("is_active")
  main_category_id String       @map("main_category_id")
  main_category    MainCategory @relation(fields: [main_category_id], references: [id], onDelete: Cascade)
  created_at       DateTime     @default(now()) @map("created_at")
  updated_at       DateTime     @updatedAt @map("updated_at")
  
  // Relations
  sub_sub_categories SubSubCategory[]
  
  @@map("sub_categories")
}

// Level 3: Sub Sub Categories
model SubSubCategory {
  id              String      @id @default(uuid())
  name            String
  description     String?
  sort_order      Int         @default(0) @map("sort_order")
  is_active       Boolean     @default(true) @map("is_active")
  sub_category_id String      @map("sub_category_id")
  sub_category    SubCategory @relation(fields: [sub_category_id], references: [id], onDelete: Cascade)
  created_at      DateTime    @default(now()) @map("created_at")
  updated_at      DateTime    @updatedAt @map("updated_at")
  
  // Relations
  sub_sub_sub_categories SubSubSubCategory[]
  
  @@map("sub_sub_categories")
}

// Level 4: Sub Sub Sub Categories
model SubSubSubCategory {
  id                 String         @id @default(uuid())
  name               String
  description        String?
  sort_order         Int            @default(0) @map("sort_order")
  is_active          Boolean        @default(true) @map("is_active")
  sub_sub_category_id String        @map("sub_sub_category_id")
  sub_sub_category   SubSubCategory @relation(fields: [sub_sub_category_id], references: [id], onDelete: Cascade)
  created_at         DateTime       @default(now()) @map("created_at")
  updated_at         DateTime       @updatedAt @map("updated_at")
  
  @@map("sub_sub_sub_categories")
}

// Simplified Frontend-Compatible Subcategory Model
model Subcategory {
  id              String     @id @default(uuid())
  name            String
  description     String?
  color           String     @default("#3B82F6")
  category_id     String     @map("category_id")
  category        Category   @relation("CategorySubcategories", fields: [category_id], references: [id], onDelete: Cascade)
  parent_id       String?    @map("parent_id")
  parent          Subcategory? @relation("SubcategoryHierarchy", fields: [parent_id], references: [id])
  children        Subcategory[] @relation("SubcategoryHierarchy")
  level           Int        @default(0)
  sort_order      Int        @default(0) @map("sort_order")
  is_visible      Boolean    @default(true) @map("is_visible")
  options         Json?      @default("{}")
  linked_products Json?      @default("[]") @map("linked_products")
  created_at      DateTime   @default(now()) @map("created_at")
  updated_at      DateTime   @updatedAt @map("updated_at")
  
  @@map("subcategories")
}

// Company Settings - Store key-value configuration for each company
model CompanySetting {
  id          String   @id @default(uuid())
  company_id  String   @map("company_id")
  company     Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  setting_key String   @map("setting_key")
  setting_value Json?  @map("setting_value")
  created_at  DateTime @default(now()) @map("created_at")
  updated_at  DateTime @updatedAt @map("updated_at")
  
  @@unique([company_id, setting_key])
  @@map("company_settings")
}

// System Modules - Available features/modules in the system
model SystemModule {
  id            String   @id @default(uuid())
  name          String   @unique
  description   String?
  category      String?  // 'TRADIES', 'SME', 'UNIVERSAL'
  is_core       Boolean  @default(false) @map("is_core")
  pricing_tier  String   @default("BASIC") @map("pricing_tier")
  is_active     Boolean  @default(true) @map("is_active")
  created_at    DateTime @default(now()) @map("created_at")
  updated_at    DateTime @updatedAt @map("updated_at")
  
  // Relations
  company_modules CompanyModule[]
  
  @@map("system_modules")
}

// Company Module Subscriptions - Which modules each company has activated
model CompanyModule {
  id           String       @id @default(uuid())
  company_id   String       @map("company_id")
  company      Company      @relation(fields: [company_id], references: [id], onDelete: Cascade)
  module_id    String       @map("module_id")
  module       SystemModule @relation(fields: [module_id], references: [id], onDelete: Cascade)
  is_active    Boolean      @default(true) @map("is_active")
  activated_at DateTime     @default(now()) @map("activated_at")
  created_at   DateTime     @default(now()) @map("created_at")
  updated_at   DateTime     @updatedAt @map("updated_at")
  
  @@unique([company_id, module_id])
  @@map("company_modules")
}

// Onboarding Progress - Track company onboarding steps
model OnboardingProgress {
  id                String   @id @default(uuid())
  company_id        String   @unique @map("company_id")
  company           Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)
  current_step      Int      @default(0) @map("current_step")
  completed_steps   Json     @default("[]") @map("completed_steps")
  target_market     String?  @map("target_market") // 'TRADIES', 'SME'
  industry_type     String?  @map("industry_type")
  team_size         String?  @map("team_size")
  selected_modules  Json     @default("[]") @map("selected_modules")
  payment_profiles  Json     @default("[]") @map("payment_profiles")
  is_completed      Boolean  @default(false) @map("is_completed")
  completed_at      DateTime? @map("completed_at")
  created_at        DateTime @default(now()) @map("created_at")
  updated_at        DateTime @updatedAt @map("updated_at")
  
  @@map("onboarding_progress")
}

// Email Templates - Store system email templates
model EmailTemplate {
  id            String   @id @default(uuid())
  template_key  String   @unique @map("template_key")
  subject       String
  html_content  String?  @map("html_content")
  text_content  String?  @map("text_content")
  variables     Json?    @default("{}") // Store template variables
  is_active     Boolean  @default(true) @map("is_active")
  created_at    DateTime @default(now()) @map("created_at")
  updated_at    DateTime @updatedAt @map("updated_at")
  
  @@map("email_templates")
}

// Notifications - System notifications for users
model Notification {
  id         String   @id @default(uuid())
  company_id String?  @map("company_id")
  company    Company? @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user_id    String?  @map("user_id")
  user       User?    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  type       String   // 'welcome', 'trial_expiring', 'module_activated', etc.
  title      String
  message    String?
  data       Json?    @default("{}")
  is_read    Boolean  @default(false) @map("is_read")
  read_at    DateTime? @map("read_at")
  created_at DateTime @default(now()) @map("created_at")
  updated_at DateTime @updatedAt @map("updated_at")
  
  @@map("notifications")
}